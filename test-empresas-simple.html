<!DOCTYPE html>
<html>
<head>
    <title>Test Empresas Simple</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #00ff00; }
        .box { margin: 20px 0; padding: 15px; background: #0d1117; border: 1px solid #30363d; border-radius: 5px; }
        button { padding: 10px 20px; background: #238636; color: white; border: none; cursor: pointer; margin: 5px; border-radius: 3px; }
        button:hover { background: #2ea043; }
        .output { background: #0d1117; padding: 15px; border-radius: 5px; max-height: 600px; overflow-y: auto; font-size: 12px; white-space: pre-wrap; word-break: break-all; border: 1px solid #30363d; margin-top: 10px; }
        h1 { color: #58a6ff; }
        .error { color: #f85149; }
        .success { color: #3fb950; }
    </style>
</head>
<body>
    <h1>üîç Test Empresas Simple</h1>

    <div class="box">
        <button onclick="testLogin()">1Ô∏è‚É£ Login y Guardar Token</button>
        <div id="login-output" class="output" style="display:none;"></div>
    </div>

    <div class="box">
        <button onclick="testEmpresas()">2Ô∏è‚É£ Cargar Empresas</button>
        <div id="empresas-output" class="output" style="display:none;"></div>
    </div>

    <div class="box">
        <button onclick="verifyToken()">3Ô∏è‚É£ Verificar Token en LocalStorage</button>
        <div id="verify-output" class="output" style="display:none;"></div>
    </div>

    <script>
        async function testLogin() {
            const output = document.getElementById('login-output');
            output.style.display = 'block';
            output.innerHTML = '<span class="success">‚è≥ Haciendo login...</span>';

            try {
                const response = await fetch('http://localhost/GestorX/gestorx-backend/api/auth.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'login',
                        correo: 'maestro@gestorx.test',
                        password: 'Maestro@2026'
                    })
                });

                const text = await response.text();
                output.textContent = `Status: ${response.status}\n\n${text}`;

                try {
                    const data = JSON.parse(text);
                    if (data.success && data.token) {
                        localStorage.setItem('token', data.token);
                        localStorage.setItem('user', JSON.stringify(data.user));
                        output.textContent += '\n\n‚úÖ Token guardado en localStorage';
                    }
                } catch (e) {
                    output.innerHTML += '\n\n<span class="error">‚ö†Ô∏è No es JSON v√°lido</span>';
                }
            } catch (error) {
                output.innerHTML = '<span class="error">‚ùå Error: ' + error.message + '</span>';
            }
        }

        async function testEmpresas() {
            const output = document.getElementById('empresas-output');
            output.style.display = 'block';
            output.innerHTML = '<span class="success">‚è≥ Cargando empresas...</span>';

            const token = localStorage.getItem('token');
            if (!token) {
                output.innerHTML = '<span class="error">‚ùå No hay token. Haz login primero.</span>';
                return;
            }

            try {
                const response = await fetch('http://localhost/GestorX/gestorx-backend/api/empresas-simple.php', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const text = await response.text();
                output.textContent = `Status: ${response.status}\n\nRespuesta:\n${text}`;

                try {
                    const data = JSON.parse(text);
                    if (data.success) {
                        output.textContent += `\n\n‚úÖ ${data.total} empresas encontradas`;
                    }
                } catch (e) {
                    output.innerHTML += '<br><span class="error">‚ö†Ô∏è JSON inv√°lido: ' + e.message + '</span>';
                }
            } catch (error) {
                output.innerHTML = '<span class="error">‚ùå Error: ' + error.message + '</span>';
            }
        }

        function verifyToken() {
            const output = document.getElementById('verify-output');
            output.style.display = 'block';
            
            const token = localStorage.getItem('token');
            const user = JSON.parse(localStorage.getItem('user') || '{}');

            if (token) {
                output.innerHTML = `<span class="success">‚úÖ Token presente</span>\n${token.substring(0, 80)}...\n\nUsuario: ${JSON.stringify(user, null, 2)}`;
            } else {
                output.innerHTML = '<span class="error">‚ùå No hay token en localStorage</span>';
            }
        }
    </script>
</body>
</html>
